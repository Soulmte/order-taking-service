<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Excelæ•°æ®ç”Ÿæˆå™¨</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        #previewTable th, #previewTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #previewTable th {
            background-color: #f5f5f5;
        }

        #previewTable tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #previewTable tr:hover {
            background-color: #f5f5f5;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
            background-color: #f5f7fa;
            color: #2c3e50;
        }

        h1 {
            text-align: center;
            color: #34495e;
            margin-bottom: 40px;
            font-weight: 500;
            font-size: 2.5em;
        }

        .upload-section {
            background: white;
            margin: 50px auto;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
            border: 3px dashed #3498db;
            width: 80%;
            max-width: 800px;
        }

        .upload-section.drag-over {
            background-color: #f8f9fa;
            border-color: #2ecc71;
        }

        .upload-section .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 20px;
        }

        .upload-section:hover {
            transform: translateY(-5px);
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1.1em;
        }

        .upload-button:hover {
            background-color: #2980b9;
        }

        .fields-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .field-config {
            background: #f8f9fa;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .field-config:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .field-config h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .field-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .field-row label {
            min-width: 100px;
            color: #7f8c8d;
        }

        select, input[type="text"], input[type="number"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        .generate-section {
            margin-top: 30px;
            text-align: center;
        }

        .row-count-input {
            margin-bottom: 20px;
            text-align: center;
        }

        .row-count-input label {
            display: block;
            margin-bottom: 10px;
            color: #7f8c8d;
        }

        .row-count-input input {
            width: 200px;
            text-align: center;
        }

        button {
            padding: 12px 30px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading.active {
            display: flex;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <h1>Excelæ•°æ®ç”Ÿæˆå™¨</h1>
    
    <div class="upload-section" id="dropZone">
        <div class="upload-icon">ğŸ“</div>
        <label class="upload-button" for="excelFile">
            <span>é€‰æ‹©Excelæ–‡ä»¶</span>
            <input type="file" id="excelFile" accept=".xlsx,.xls" />
        </label>
        <p style="margin-top: 15px; color: #7f8c8d;">æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼æ–‡ä»¶<br>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</p>
    </div>

    <div id="fieldsContainer" class="fields-section" style="display: none;">
        <h2 style="margin-bottom: 30px; color: #34495e;">å­—æ®µé…ç½®</h2>
        <div id="fieldsList"></div>
        
        <div class="generate-section">
            <div class="row-count-input">
                <label>ç”Ÿæˆæ•°æ®è¡Œæ•°ï¼š</label>
                <input type="number" id="rowCount" value="100" min="1" max="10000" />
            </div>
            <button onclick="previewData()">é¢„è§ˆæ•°æ®</button>
            <button onclick="generateData()">ç”ŸæˆExcel</button>
        </div>
        <div id="previewContainer" style="display: none; margin-top: 20px;">
            <h3>æ•°æ®é¢„è§ˆ</h3>
            <div style="overflow-x: auto;">
                <table id="previewTable" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="loading">
        <div class="loading-spinner"></div>
    </div>

    <script>
        let workbook = null;
        let fields = [];

        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            const reader = new FileReader();

            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                workbook = XLSX.read(data, {type: 'array'});
                
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                
                fields = jsonData[0];
                displayFields(fields);
                loading.classList.remove('active');
            };

            reader.onerror = function() {
                alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
                loading.classList.remove('active');
            };

            reader.readAsArrayBuffer(file);
        });

        function displayFields(fields) {
            const container = document.getElementById('fieldsList');
            container.innerHTML = '';
            
            fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-config';
                
                // å…ˆåˆ›å»ºå®Œæ•´çš„HTMLç»“æ„
                fieldDiv.innerHTML = `
                    <h3>${field}</h3>
                    <div class="field-row">
                        <label>æ•°æ®ç±»å‹ï¼š</label>
                        <select id="type_${field}" onchange="updateFieldVisibility('${field}')">
                            <option value="number">æ•°å­—</option>
                            <option value="text">æ–‡æœ¬</option>
                            <option value="date">æ—¥æœŸ</option>
                            <option value="boolean">å¸ƒå°”å€¼</option>
                            <option value="email">ç”µå­é‚®ä»¶</option>
                            <option value="phone">æ‰‹æœºå·ç </option>
                            <option value="address">åœ°å€</option>
                        </select>
                    </div>
                    <div class="field-row number-field" id="min_row_${field}">
                        <label>æœ€å°å€¼ï¼š</label>
                        <input type="text" id="min_${field}" placeholder="è¯·è¾“å…¥æœ€å°å€¼" />
                    </div>
                    <div class="field-row number-field" id="max_row_${field}">
                        <label>æœ€å¤§å€¼ï¼š</label>
                        <input type="text" id="max_${field}" placeholder="è¯·è¾“å…¥æœ€å¤§å€¼" />
                    </div>
                    <div class="field-row text-field" id="text_range_row_${field}" style="display: none;">
                        <label>å¯é€‰å€¼ï¼š</label>
                        <input type="text" id="text_range_${field}" placeholder="è¯·è¾“å…¥å¯é€‰å€¼ï¼Œç”¨é€—å·åˆ†éš”" />
                    </div>
                    <div class="field-row email-field" id="email_suffix_row_${field}" style="display: none;">
                        <label>é‚®ç®±åç¼€ï¼š</label>
                        <input type="text" id="email_suffix_${field}" placeholder="å¤šä¸ªåç¼€ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šgmail.com,qq.com" />
                    </div>
                    <div class="field-row address-field" id="provinces_row_${field}" style="display: none;">
                        <label>çœä»½ï¼š</label>
                        <input type="text" id="provinces_${field}" placeholder="å¤šä¸ªçœä»½ç”¨é€—å·åˆ†éš”" />
                    </div>
                    <div class="field-row address-field" id="cities_row_${field}" style="display: none;">
                        <label>åŸå¸‚ï¼š</label>
                        <input type="text" id="cities_${field}" placeholder="å¤šä¸ªåŸå¸‚ç”¨é€—å·åˆ†éš”" />
                    </div>
                    <div class="field-row address-field" id="districts_row_${field}" style="display: none;">
                        <label>åŒºåŸŸï¼š</label>
                        <input type="text" id="districts_${field}" placeholder="å¤šä¸ªåŒºåŸŸç”¨é€—å·åˆ†éš”" />
                    </div>
                `;
                container.appendChild(fieldDiv);

                // åœ¨å…ƒç´ æ·»åŠ åˆ°DOMåè®¾ç½®åˆå§‹å¯è§æ€§
                const selectElement = document.getElementById(`type_${field}`);
                updateFieldVisibility(field);
            });

            document.getElementById('fieldsContainer').style.display = 'block';
        }

        // æ·»åŠ æ–°çš„å‡½æ•°æ¥å¤„ç†å­—æ®µå¯è§æ€§
        function updateFieldVisibility(field) {
            const type = document.getElementById(`type_${field}`).value;
            const numberFields = document.querySelectorAll(`#min_row_${field}, #max_row_${field}`);
            const textField = document.getElementById(`text_range_row_${field}`);
            const emailField = document.getElementById(`email_suffix_row_${field}`);
            const addressFields = document.querySelectorAll(`#provinces_row_${field}, #cities_row_${field}, #districts_row_${field}`);

            // éšè—æ‰€æœ‰å­—æ®µ
            numberFields.forEach(el => el.style.display = 'none');
            textField.style.display = 'none';
            emailField.style.display = 'none';
            addressFields.forEach(el => el.style.display = 'none');

            // æ ¹æ®ç±»å‹æ˜¾ç¤ºç›¸åº”å­—æ®µ
            switch(type) {
                case 'number':
                case 'date':
                    numberFields.forEach(el => el.style.display = 'flex');
                    break;
                case 'text':
                    textField.style.display = 'flex';
                    break;
                case 'email':
                    emailField.style.display = 'flex';
                    break;
                case 'address':
                    addressFields.forEach(el => el.style.display = 'flex');
                    break;
            }
        }

        function generateRandomValue(type, min, max, field) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            switch(type) {
                case 'number':
                    min = parseFloat(min) || 0;
                    max = parseFloat(max) || 100;
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                case 'text':
                    const textRangeInput = document.getElementById(`text_range_${field}`);
                    let textRange = ['ç¤ºä¾‹æ–‡æœ¬1', 'ç¤ºä¾‹æ–‡æœ¬2', 'ç¤ºä¾‹æ–‡æœ¬3'];
                    if (textRangeInput && textRangeInput.value.trim()) {
                        textRange = textRangeInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }
                    return textRange[Math.floor(Math.random() * textRange.length)];
                case 'date':
                    const startDate = min ? new Date(min) : new Date('2020-01-01');
                    const endDate = max ? new Date(max) : new Date();
                    const randomDate = new Date(startDate.getTime() + Math.random() * (endDate.getTime() - startDate.getTime()));
                    return randomDate.toISOString().split('T')[0];
                case 'boolean':
                    return Math.random() < 0.5;
                case 'email':
                    const emailSuffixInput = document.getElementById(`email_suffix_${field}`);
                    let domains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', '163.com'];
                    if (emailSuffixInput && emailSuffixInput.value.trim()) {
                        domains = emailSuffixInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }
                    const username = Array.from({length: 8}, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
                    return `${username}@${domains[Math.floor(Math.random() * domains.length)]}`;
                case 'phone':
                    const prefixes = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152'];
                    const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
                    const suffix = Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
                    return prefix + suffix;
                case 'address':
                    const provincesInput = document.getElementById(`provinces_${field}`);
                    const citiesInput = document.getElementById(`cities_${field}`);
                    const districtsInput = document.getElementById(`districts_${field}`);
                    
                    let provinces = ['åŒ—äº¬å¸‚', 'ä¸Šæµ·å¸‚', 'å¹¿ä¸œçœ', 'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ'];
                    let cities = ['å¸‚è¾–åŒº', 'å—äº¬å¸‚', 'æ­å·å¸‚', 'å¹¿å·å¸‚', 'æ·±åœ³å¸‚'];
                    let districts = ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'æµ¦ä¸œæ–°åŒº', 'ç¦ç”°åŒº', 'å§‘è‹åŒº'];
                    
                    if (provincesInput && provincesInput.value.trim()) {
                        provinces = provincesInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }
                    if (citiesInput && citiesInput.value.trim()) {
                        cities = citiesInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }
                    if (districtsInput && districtsInput.value.trim()) {
                        districts = districtsInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }
                    
                    return `${provinces[Math.floor(Math.random() * provinces.length)]}${cities[Math.floor(Math.random() * cities.length)]}${districts[Math.floor(Math.random() * districts.length)]}`;
                default:
                    return '';
            }
        }

        function generateRandomData() {
            const rowCount = parseInt(document.getElementById('rowCount').value) || 100;
            const config = {};
            fields.forEach(field => {
                config[field] = {
                    type: document.getElementById(`type_${field}`).value,
                    min: document.getElementById(`min_${field}`).value,
                    max: document.getElementById(`max_${field}`).value
                };
            });

            let data = [];
            for(let i = 0; i < rowCount; i++) {
                const row = {};
                fields.forEach(field => {
                    row[field] = generateRandomValue(
                        config[field].type,
                        config[field].min,
                        config[field].max,
                        field
                    );
                });
                data.push(row);
            }
            return data;
        }

        function previewData() {
            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            setTimeout(() => {
                const data = generateRandomData();
                const previewContainer = document.getElementById('previewContainer');
                const table = document.getElementById('previewTable');
                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');

                // æ¸…ç©ºè¡¨æ ¼
                thead.innerHTML = '';
                tbody.innerHTML = '';

                // æ·»åŠ è¡¨å¤´
                const headerRow = document.createElement('tr');
                fields.forEach(field => {
                    const th = document.createElement('th');
                    th.textContent = field;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                // æ·»åŠ æ•°æ®è¡Œï¼ˆæœ€å¤šæ˜¾ç¤º10è¡Œï¼‰
                const previewRows = data.slice(0, 10);
                previewRows.forEach(row => {
                    const tr = document.createElement('tr');
                    fields.forEach(field => {
                        const td = document.createElement('td');
                        td.textContent = row[field];
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                previewContainer.style.display = 'block';
                loading.classList.remove('active');
            }, 100);
        }

        function generateData() {
            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            setTimeout(() => {
                const data = generateRandomData();
                const newWorkbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.json_to_sheet(data);
                XLSX.utils.book_append_sheet(newWorkbook, worksheet, "ç”Ÿæˆæ•°æ®");

                XLSX.writeFile(newWorkbook, "generated_data.xlsx");
                loading.classList.remove('active');
            }, 100);
        }

        // æ·»åŠ æ‹–æ”¾å¤„ç†
        const dropZone = document.getElementById('dropZone');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                document.getElementById('excelFile').files = e.dataTransfer.files;
                document.getElementById('excelFile').dispatchEvent(new Event('change'));
            }
        });
    </script>
</body>
</html>
